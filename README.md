# 数据库表结构设计器

一个功能强大的可视化数据库表结构设计工具，支持通过拖拽方式设计数据库表结构，并能够生成SQL语句或直接同步到数据库。

## 功能特性

### 🎨 可视化设计
- **拖拽式界面**：通过简单的拖拽操作创建和设计数据库表
- **直观的表结构展示**：清晰展示表名、字段名、数据类型等关键信息
- **实时属性编辑**：在属性面板中实时编辑表和字段属性

### 💾 数据库支持
- **多数据库操作**：支持创建、读取、更新和删除数据库表
- **实时同步**：设计变更可实时同步到实际数据库
- **表结构导入**：从现有数据库导入表结构进行编辑

### 🔧 高级功能
- **SQL生成**：自动生成创建表的SQL语句
- **JSON编辑器**：通过JSON格式导入导出表结构设计
- **字段管理**：支持添加、删除、修改字段属性
- **表复制**：快速复制现有表结构

### 🛠 技术特性
- **响应式设计**：适配不同屏幕尺寸
- **语法高亮**：SQL和JSON语法高亮显示
- **实时验证**：输入数据的实时验证和错误提示
- **操作历史**：完整的操作记录和状态反馈

## 系统要求

- Python 3.7+
- Flask 2.0+
- SQLite3

## 安装和运行

### 1. 环境准备

确保系统中已安装Python 3.7或更高版本：

```bash
python --version
```

### 2. 安装依赖

项目使用Flask框架，无需额外安装依赖包：

```bash
# 如果需要，可以创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

### 3. 运行应用

```bash
python app.py
```

应用启动后，在浏览器中访问：`http://localhost:5000`

## 项目结构

```
database-designer/
├── app.py              # Flask后端主程序
├── index.html          # 前端界面
├── database_designer.db # 主数据库文件（自动生成）
├── design_storage.db   # 设计数据存储数据库（自动生成）
└── README.md          # 项目说明文档
```

## 使用指南

### 基本操作

1. **创建新表**
   - 从左侧工具栏拖拽"数据表"到画布
   - 或点击"新建表"按钮

2. **编辑表属性**
   - 点击选择表
   - 在右侧属性面板中编辑表名和注释

3. **管理字段**
   - 点击表中的字段行进行选择
   - 在属性面板中编辑字段属性
   - 使用"添加字段"按钮新增字段
   - 使用字段行右侧的删除按钮移除字段

### 字段属性说明

- **字段名**：数据库中的列名
- **数据类型**：支持INTEGER、VARCHAR、TEXT、DATETIME等
- **长度/值**：字段长度限制（如VARCHAR(255)）
- **默认值**：字段的默认值
- **字段注释**：字段的说明信息
- **主键**：是否为主键字段
- **允许为空**：字段是否允许NULL值
- **唯一**：字段值是否必须唯一

### 数据库操作

1. **保存表到数据库**
   - 选择表后点击"保存表"或"同步到数据库"
   - 系统会根据表是否存在自动执行创建或更新操作

2. **从数据库加载表**
   - 点击"加载表"按钮导入现有数据库表结构

3. **生成SQL**
   - 点击"生成SQL"查看创建表的SQL语句
   - 支持复制SQL到剪贴板
   - 支持直接执行SQL语句

### JSON编辑器

1. **打开JSON编辑器**
   - 点击工具栏中的"JSON编辑器"按钮
   - 或点击顶部菜单的"导出JSON"

2. **功能说明**
   - **格式化**：美化JSON格式
   - **应用**：将JSON数据应用到当前设计
   - **关闭**：关闭编辑器

## API接口文档

### 表管理接口

| 方法 | 端点 | 描述 |
|------|------|------|
| GET | `/api/tables` | 获取所有表列表 |
| POST | `/api/tables` | 创建新表 |
| PUT | `/api/tables/<table_name>` | 更新表结构 |
| DELETE | `/api/tables/<table_name>` | 删除表 |
| GET | `/api/tables/<table_name>` | 获取表详情 |

### 字段管理接口

| 方法 | 端点 | 描述 |
|------|------|------|
| POST | `/api/tables/<table_name>/fields` | 添加字段 |
| PUT | `/api/tables/<table_name>/fields/<field_name>` | 更新字段 |
| DELETE | `/api/tables/<table_name>/fields/<field_name>` | 删除字段 |

### 工具接口

| 方法 | 端点 | 描述 |
|------|------|------|
| POST | `/api/execute-sql` | 执行自定义SQL |
| GET | `/api/database-status` | 获取数据库状态 |

## 数据存储

### 数据库文件

1. **database_designer.db**
   - 存储实际创建的数据库表
   - 包含用户数据

2. **design_storage.db**
   - 存储表结构设计数据
   - 保存表注释等元信息

### 设计数据格式

```json
{
  "tables": [
    {
      "id": "table-1",
      "name": "users",
      "comment": "用户表",
      "x": 100,
      "y": 100,
      "fields": [
        {
          "name": "id",
          "type": "INTEGER",
          "length": "",
          "primary": true,
          "nullable": false,
          "unique": true,
          "default": "",
          "comment": "用户ID"
        }
      ]
    }
  ],
  "nextTableId": 2
}
```

## 快捷键和提示

- **拖拽移动**：拖拽表头可以移动表位置
- **快速选择**：点击表选择整个表，点击字段行选择单个字段
- **批量操作**：支持通过JSON编辑器批量导入导出表结构
- **实时反馈**：状态栏显示当前操作状态和选中对象信息

## 故障排除

### 常见问题

1. **应用无法启动**
   - 检查Python版本是否符合要求
   - 确认5000端口未被占用

2. **数据库操作失败**
   - 检查数据库文件权限
   - 确认表名不包含特殊字符

3. **界面显示异常**
   - 清除浏览器缓存
   - 检查网络连接，确保Font Awesome图标库可访问

### 日志查看

应用运行时的错误信息会显示在控制台，开发模式下会显示详细的错误信息。

## 开发说明

### 扩展功能

要添加新的数据类型：
1. 在`index.html`的字段类型选择器中添加选项
2. 在SQL生成逻辑中处理新类型的语法

### 自定义样式

修改`index.html`中的CSS样式来自定义界面外观，主要样式类包括：
- `.table` - 表容器样式
- `.table-header` - 表头样式
- `.table-row` - 字段行样式
- `.property-section` - 属性面板样式

## 许可证

本项目采用MIT许可证。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 更新日志

### v1.0.0
- 初始版本发布
- 基础的表结构设计功能
- SQL生成和执行功能
- JSON导入导出支持
